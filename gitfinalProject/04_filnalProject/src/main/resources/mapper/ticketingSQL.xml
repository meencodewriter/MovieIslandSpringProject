<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org/DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="ticketing">
<select id="selectSchedule" parameterType="string" resultType="map">
	select distinct movie_title
	from schedule_tbl 
	join movie_tbl using(movie_title) 
	where to_char(schedule_start, 'dd/mm/yyyy') = #{_parameter}
</select>
<select id="selectOneTheaterBrch" parameterType="_int" resultType="theater">
  	select 
		 	theater_no as theaterNo,
			theater_local as theaterLocal,
			theater_branch as theaterBranch,
			theater_addr as theaterAddr,	
			theater_facility as theaterFacility,
			theater_content as theaterContent,
			enroll_member as EnrollMember		
	  from theater_tbl
	  where theater_no = #{_parameter}
</select>
<select id="choiceDayTheater" parameterType="map" resultType="theaterLocalCount">
	select count(*) as count, theater_local as theaterLocal
	from theater_tbl  
	join schedule_tbl using(theater_branch) 
	where movie_title = #{movieTitle} 
	and to_char(schedule_start, 'DD/MM/YYYY') = #{choiceDataDay} 
	group by theater_local
</select>
<select id="choiceLocalBranch" parameterType="map" resultType="string">
	SELECT 
		THEATER_BRANCH 
	FROM 
		THEATER_TBL 
	JOIN SCHEDULE_TBL USING(THEATER_BRANCH) 
	WHERE 
		MOVIE_TITLE = #{movieTitle} 
		AND 
		to_CHAR(SCHEDULE_START, 'DD/MM/YYYY') = #{choiceDataDay} 
		AND 
		THEATER_LOCAL = #{theaterLocal}
</select>

<select id="choiceBranchSchedule" parameterType="map" resultType="ticketingSchedule">
	select 
		movie_title as movieTitle, 
		to_char(schedule_start,'hh24:mi') as scheduleStart, 
        to_char(schedule_end,'hh24:mi') as scheduleEnd,
		theater_branch as theaterBranch
	from 
		schedule_tbl 
	where 
		movie_title = #{movieTitle} 
		and to_char(schedule_start, 'DD/MM/YYYY') = #{choiceDataDay}
		and to_char(schedule_end, 'DD/MM/YYYY') = #{choiceDataDay} 
		and theater_branch = #{theaterBranch}
</select> 
<select id="selectGiftTicket" parameterType="_int" resultType="giftTicket">
	select
	    gift_ticket_no as giftTicketNo,
	    gift_ticket_serial as giftTicketSerial,
	    gift_ticket_name as giftTicketName,
	    gift_ticket_date as giftTicketDate,
	    gift_ticket_status as giftTicketStatus
	from
	    gift_ticket
	where
	    member_no = #{_parameter}
</select>
</mapper>
